<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø¯ÙƒØ§Ù† Ø§Ù„Ø£ÙƒÙŠØ§Ø³ - Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</title>
    <!-- Ø®Ø· ØªØ¬ÙˆØ§Ù„ Ù…Ù† Ø¬ÙˆØ¬Ù„ -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #0f5132; /* Ø£Ø®Ø¶Ø± Ø¯Ø§ÙƒÙ† */
            --secondary-color: #198754; /* Ø£Ø®Ø¶Ø± ÙØ§ØªØ­ */
            --accent-color: #ffc107; /* Ø£ØµÙØ± Ù„Ù„ØªØ­Ø°ÙŠØ±Ø§Øª */
            --danger-color: #dc3545;
            --light-bg: #f8f9fa;
            --white: #ffffff;
            --border-color: #dee2e6;
            --text-color: #212529;
            --sidebar-width: 260px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Tajawal', sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
        }

        /* --- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ --- */
        #login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .login-box {
            background: var(--white);
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .login-box img {
            width: 100px;
            margin-bottom: 1rem;
        }

        .login-box h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }

        .input-group {
            margin-bottom: 1rem;
            text-align: right;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary { background-color: var(--primary-color); color: var(--white); width: 100%; }
        .btn-primary:hover { background-color: #0a3622; }
        .btn-success { background-color: var(--secondary-color); color: var(--white); }
        .btn-danger { background-color: var(--danger-color); color: var(--white); }
        .btn-warning { background-color: var(--accent-color); color: #000; }
        .btn-outline { border: 1px solid var(--border-color); background: transparent; color: var(--text-color); }

        /* --- Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ --- */
        #app-container {
            display: flex;
            height: 100vh;
            display: none; /* Ù…Ø®ÙÙŠ Ø­ØªÙ‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        #sidebar {
            width: var(--sidebar-width);
            background-color: var(--primary-color);
            color: var(--white);
            display: flex;
            flex-direction: column;
            padding: 1rem;
            transition: 0.3s;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 2rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 1rem;
        }

        .brand img { width: 50px; }
        .brand h1 { font-size: 1.2rem; }

        .nav-links { list-style: none; flex: 1; }
        .nav-links li { margin-bottom: 0.5rem; }
        
        .nav-btn {
            width: 100%;
            text-align: right;
            padding: 12px 15px;
            background: rgba(255,255,255,0.05);
            color: var(--white);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
        }

        .nav-btn:hover, .nav-btn.active { background-color: var(--secondary-color); }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        #main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #f4f6f9;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            background: var(--white);
            padding: 15px;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        .section-title { font-size: 1.5rem; color: var(--primary-color); font-weight: bold; }

        /* --- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª (Dashboard) --- */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            border-right: 5px solid var(--primary-color);
        }

        .stat-card h3 { color: #6c757d; font-size: 0.9rem; margin-bottom: 10px; }
        .stat-card .value { font-size: 1.8rem; font-weight: bold; color: var(--text-color); }

        /* --- Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ --- */
        .table-container {
            background: var(--white);
            border-radius: 10px;
            box-shadow: var(--shadow);
            overflow-x: auto;
            padding: 15px;
        }

        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: right; border-bottom: 1px solid var(--border-color); }
        th { background-color: #f8f9fa; color: var(--primary-color); }
        tr:hover { background-color: #f1f1f1; }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        .status-low { background-color: #ffebee; color: var(--danger-color); }
        .status-ok { background-color: #e8f5e9; color: var(--secondary-color); }

        /* --- Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª --- */
        .sales-layout { display: flex; gap: 20px; height: calc(100vh - 150px); }
        .products-area { flex: 2; overflow-y: auto; }
        .cart-area { flex: 1; background: var(--white); border-radius: 10px; padding: 15px; display: flex; flex-direction: column; box-shadow: var(--shadow); }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .product-card {
            background: var(--white);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: 0.2s;
            text-align: center;
        }

        .product-card:hover { border-color: var(--primary-color); transform: translateY(-3px); }
        .product-card .name { font-weight: bold; margin-bottom: 5px; }
        .product-card .price { color: var(--secondary-color); font-weight: bold; }
        .product-card .stock { font-size: 0.8rem; color: #666; }

        .cart-items { flex: 1; overflow-y: auto; border-bottom: 1px solid var(--border-color); margin-bottom: 10px; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; }
        .cart-total { font-size: 1.2rem; font-weight: bold; text-align: left; margin-bottom: 10px; }

        /* --- Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©) --- */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: var(--white);
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* --- Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© --- */
        @media print {
            body * { visibility: hidden; }
            #print-area, #print-area * { visibility: visible; }
            #print-area { position: absolute; left: 0; top: 0; width: 100%; padding: 20px; }
            .no-print { display: none !important; }
        }

        /* --- ØªØ¬Ø§ÙˆØ¨ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ --- */
        @media (max-width: 768px) {
            #app-container { flex-direction: column; }
            #sidebar { width: 100%; height: auto; padding: 10px; flex-direction: row; overflow-x: auto; }
            .nav-links { display: flex; gap: 10px; }
            .nav-links li { margin-bottom: 0; }
            .nav-btn { width: auto; white-space: nowrap; }
            .brand { display: none; }
            .sales-layout { flex-direction: column; height: auto; }
            .cart-area { order: 2; }
        }
    </style>
</head>
<body>

    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="login-screen">
        <div class="login-box">
            <img src="https://image.qwenlm.ai/public_source/da381527-bc5d-42bd-a8ca-3fb29aacd50d/1e181161a-a100-46bb-9159-d7977d6004f2.png" alt="Logo">
            <h2>Ù†Ø¸Ø§Ù… Ø¯ÙƒØ§Ù† Ø§Ù„Ø£ÙƒÙŠØ§Ø³</h2>
            <div class="input-group">
                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input type="password" id="login-pass" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (1234)">
            </div>
            <button class="btn btn-primary" onclick="app.login()">Ø¯Ø®ÙˆÙ„</button>
            <p id="login-error" style="color: red; margin-top: 10px; display: none;">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©</p>
        </div>
    </div>

    <!-- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div id="app-container">
        <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
        <aside id="sidebar">
            <div class="brand">
                <img src="https://image.qwenlm.ai/public_source/da381527-bc5d-42bd-a8ca-3fb29aacd50d/1e181161a-a100-46bb-9159-d7977d6004f2.png" alt="Logo">
                <h1>Ù†Ø¸Ø§Ù… Ø§Ù„Ø£ÙƒÙŠØ§Ø³</h1>
            </div>
            <ul class="nav-links">
                <li><button class="nav-btn active" onclick="app.nav('dashboard')">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button></li>
                <li><button class="nav-btn" onclick="app.nav('sales')">ğŸ›’ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Ù†Ù‚Ø·Ø© Ø¨ÙŠØ¹)</button></li>
                <li><button class="nav-btn" onclick="app.nav('inventory')">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button></li>
                <li><button class="nav-btn" onclick="app.nav('expenses')">ğŸ’° Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</button></li>
                <li><button class="nav-btn" onclick="app.nav('suppliers')">ğŸ‘¥ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</button></li>
                <li><button class="nav-btn" onclick="app.nav('reports')">ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button></li>
                <li><button class="nav-btn" onclick="app.nav('settings')">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button></li>
                <li><button class="nav-btn" style="background-color: #dc3545;" onclick="app.logout()">ğŸšª Ø®Ø±ÙˆØ¬</button></li>
            </ul>
        </aside>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
        <main id="main-content">
            <header>
                <div class="section-title" id="page-title">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
                <div id="date-display" style="color: #666;"></div>
            </header>

            <!-- 1. Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
            <section id="dashboard-view" class="view-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                        <div class="value" id="dash-today-sales">0 Ø¬.Ø³</div>
                    </div>
                    <div class="stat-card" style="border-right-color: var(--secondary-color);">
                        <h3>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ (Ø§Ù„ÙŠÙˆÙ…)</h3>
                        <div class="value" id="dash-today-profit">0 Ø¬.Ø³</div>
                    </div>
                    <div class="stat-card" style="border-right-color: var(--danger-color);">
                        <h3>Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                        <div class="value" id="dash-today-expenses">0 Ø¬.Ø³</div>
                    </div>
                    <div class="stat-card" style="border-right-color: var(--accent-color);">
                        <h3>ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>
                        <div class="value" id="dash-low-stock">0</div>
                    </div>
                </div>
                
                <div class="table-container">
                    <h3>Ø¢Ø®Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>
                    <table id="dash-recent-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                <th>Ø§Ù„ÙˆÙ‚Øª</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <!-- 2. Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª -->
            <section id="sales-view" class="view-section" style="display: none;">
                <div class="sales-layout">
                    <div class="products-area">
                        <div style="margin-bottom: 15px;">
                            <input type="text" id="sales-search" placeholder="Ø¨Ø­Ø« Ø¹Ù† ØµÙ†Ù..." onkeyup="sales.filterProducts()" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd;">
                        </div>
                        <div class="product-grid" id="sales-products-grid">
                            <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                        </div>
                    </div>
                    <div class="cart-area">
                        <h3>Ø³Ù„Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
                        <div class="cart-items" id="cart-items-container">
                            <!-- Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø³Ù„Ø© -->
                        </div>
                        <div class="cart-total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="cart-total-display">0</span> Ø¬.Ø³</div>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <input type="number" id="cart-payment" placeholder="Ø§Ù„Ù…Ø¯ÙÙˆØ¹" style="flex: 1; padding: 8px;">
                        </div>
                        <div id="cart-change" style="margin-bottom: 10px; color: var(--secondary-color); font-weight: bold;"></div>
                        <button class="btn btn-success" onclick="sales.checkout()">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ·Ø¨Ø§Ø¹Ø©</button>
                        <button class="btn btn-outline" onclick="sales.clearCart()" style="margin-top: 5px;">Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©</button>
                    </div>
                </div>
            </section>

            <!-- 3. Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
            <section id="inventory-view" class="view-section" style="display: none;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                    <input type="text" id="inventory-search" placeholder="Ø¨Ø­Ø«..." onkeyup="inventory.render()" style="padding: 10px; width: 300px; border-radius: 8px; border: 1px solid #ddd;">
                    <button class="btn btn-primary" onclick="inventory.openModal()">+ Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯</button>
                </div>
                <div class="table-container">
                    <table id="inventory-table">
                        <thead>
                            <tr>
                                <th>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù</th>
                                <th>Ø§Ù„Ù…Ù‚Ø§Ø³/Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                <th>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</th>
                                <th>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
                                <th>Ø§Ù„Ù…ÙˆØ±Ø¯</th>
                                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <!-- 4. Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª -->
            <section id="expenses-view" class="view-section" style="display: none;">
                <div class="table-container" style="margin-bottom: 20px;">
                    <h3>Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                        <input type="text" id="exp-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ (ÙƒÙ‡Ø±Ø¨Ø§Ø¡ØŒ Ø¥ÙŠØ¬Ø§Ø±...)" style="flex: 2; padding: 10px;">
                        <input type="number" id="exp-amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" style="flex: 1; padding: 10px;">
                        <input type="date" id="exp-date" style="flex: 1; padding: 10px;">
                        <button class="btn btn-danger" onclick="expenses.add()">Ø¥Ø¶Ø§ÙØ©</button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="expenses-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                <th>Ø­Ø°Ù</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <!-- 5. Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† -->
            <section id="suppliers-view" class="view-section" style="display: none;">
                <div class="table-container" style="margin-bottom: 20px;">
                    <h3>Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                        <input type="text" id="sup-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯" style="flex: 2; padding: 10px;">
                        <input type="text" id="sup-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" style="flex: 1; padding: 10px;">
                        <button class="btn btn-primary" onclick="suppliers.add()">Ø­ÙØ¸</button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="suppliers-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø´ØªØ±ÙŠØ§ØªÙ†Ø§ Ù…Ù†Ù‡</th>
                                <th>Ø­Ø°Ù</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <!-- 6. Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
            <section id="reports-view" class="view-section" style="display: none;">
                <div class="table-container" style="margin-bottom: 20px;">
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <label>Ù…Ù†:</label> <input type="date" id="report-start">
                        <label>Ø¥Ù„Ù‰:</label> <input type="date" id="report-end">
                        <button class="btn btn-primary" onclick="reports.generate()">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                    </div>
                </div>
                <div class="stats-grid" id="report-stats">
                    <!-- ØªØ¸Ù‡Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù‡Ù†Ø§ -->
                </div>
                <div class="table-container">
                    <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
                    <table id="report-table">
                        <thead>
                            <tr>
                                <th>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                <th>Ø§Ù„Ø±Ø¨Ø­</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <!-- 7. Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
            <section id="settings-view" class="view-section" style="display: none;">
                <div class="table-container">
                    <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                    <p style="margin-bottom: 15px; color: #666;">ÙŠÙ…ÙƒÙ†Ùƒ Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø£Ùˆ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø³Ø§Ø¨Ù‚Ø©.</p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-success" onclick="settings.backup()">ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Backup)</button>
                        <button class="btn btn-warning" onclick="document.getElementById('restore-file').click()">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª (Restore)</button>
                        <input type="file" id="restore-file" style="display: none;" onchange="settings.restore(this)" accept=".json">
                        <button class="btn btn-danger" onclick="settings.reset()">Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…)</button>
                    </div>
                </div>
                <div class="table-container" style="margin-top: 20px;">
                    <h3>Ø¥ØºÙ„Ø§Ù‚ ÙŠÙˆÙ…ÙŠØ©</h3>
                    <p>Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ø¥Ù†Ù‡Ø§Ø¡ Ù†ÙˆØ¨ØªÙƒ ÙˆØ­ÙØ¸ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ….</p>
                    <button class="btn btn-outline" onclick="alert('ØªÙ… Ø­ÙØ¸ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ… Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… ØªØµÙÙŠØ± Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ….')">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ¨Ø©</button>
                </div>
            </section>
        </main>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ ØµÙ†Ù -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title">Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯</h3>
            <input type="hidden" id="prod-id">
            <div class="input-group">
                <label>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù</label>
                <input type="text" id="prod-name">
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ù…Ù‚Ø§Ø³ / Ø§Ù„Ù†ÙˆØ¹</label>
                <input type="text" id="prod-size">
            </div>
            <div class="input-group">
                <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                <input type="number" id="prod-qty">
            </div>
            <div class="input-group">
                <label>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ (Ù„Ù„Ù‚Ø·Ø¹Ø©/Ù„Ù„ÙƒØ±ØªÙˆÙ†Ø©)</label>
                <input type="number" id="prod-buy">
            </div>
            <div class="input-group">
                <label>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</label>
                <input type="number" id="prod-sell">
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ù…ÙˆØ±Ø¯</label>
                <select id="prod-supplier"></select>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" onclick="inventory.save()">Ø­ÙØ¸</button>
                <button class="btn btn-outline" onclick="document.getElementById('product-modal').classList.remove('active')">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© (Ù…Ø®ÙÙŠØ©) -->
    <div id="print-area" style="display: none; padding: 20px; font-family: 'Courier New', Courier, monospace;">
        <div style="text-align: center; border-bottom: 1px dashed #000; padding-bottom: 10px; margin-bottom: 10px;">
            <h2>Ø¯ÙƒØ§Ù† Ø§Ù„Ø£ÙƒÙŠØ§Ø³</h2>
            <p>Ø§Ù„Ø®Ø±Ø·ÙˆÙ… - Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</p>
            <p>Ù‡Ø§ØªÙ: 0912345678</p>
        </div>
        <div style="margin-bottom: 10px;">
            <p>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: <span id="print-inv-id"></span></p>
            <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: <span id="print-date"></span></p>
        </div>
        <table style="width: 100%; text-align: right; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 1px solid #000;">
                    <th>Ø§Ù„ØµÙ†Ù</th>
                    <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                    <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                </tr>
            </thead>
            <tbody id="print-items"></tbody>
        </table>
        <div style="margin-top: 20px; border-top: 1px dashed #000; padding-top: 10px;">
            <p style="display: flex; justify-content: space-between;"><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> <span id="print-total"></span></p>
            <p style="display: flex; justify-content: space-between;"><strong>Ø§Ù„Ù…Ø¯ÙÙˆØ¹:</strong> <span id="print-paid"></span></p>
            <p style="display: flex; justify-content: space-between;"><strong>Ø§Ù„Ø¨Ø§Ù‚ÙŠ:</strong> <span id="print-change"></span></p>
        </div>
        <div style="text-align: center; margin-top: 20px;">
            <p>Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ…!</p>
        </div>
    </div>

    <script>
        // --- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ---
        const app = {
            data: {
                products: [],
                sales: [],
                expenses: [],
                suppliers: []
            },
            config: {
                password: '1234'
            },

            init: function() {
                this.loadData();
                this.updateDate();
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                if (sessionStorage.getItem('isLoggedIn') === 'true') {
                    document.getElementById('login-screen').style.display = 'none';
                    document.getElementById('app-container').style.display = 'flex';
                    this.nav('dashboard');
                }
            },

            loadData: function() {
                const stored = localStorage.getItem('sudan_bag_shop_v1');
                if (stored) {
                    this.data = JSON.parse(stored);
                } else {
                    // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø£ÙˆÙ„ÙŠØ©
                    this.data.suppliers = [{id: 1, name: 'Ù…ÙˆØ±Ø¯ Ø±Ø¦ÙŠØ³ÙŠ', phone: '0900000000'}];
                    this.saveData();
                }
            },

            saveData: function() {
                localStorage.setItem('sudan_bag_shop_v1', JSON.stringify(this.data));
                dashboard.render(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¹Ù†Ø¯ Ø£ÙŠ ØªØºÙŠÙŠØ±
            },

            login: function() {
                const pass = document.getElementById('login-pass').value;
                if (pass === this.config.password) {
                    sessionStorage.setItem('isLoggedIn', 'true');
                    location.reload();
                } else {
                    document.getElementById('login-error').style.display = 'block';
                }
            },

            logout: function() {
                sessionStorage.removeItem('isLoggedIn');
                location.reload();
            },

            nav: function(viewId) {
                // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
                document.querySelectorAll('.view-section').forEach(el => el.style.display = 'none');
                document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
                document.getElementById(viewId + '-view').style.display = 'block';
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø²Ø± Ø§Ù„Ù†Ø´Ø·
                const titles = {
                    'dashboard': 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',
                    'sales': 'Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹',
                    'inventory': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',
                    'expenses': 'Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª',
                    'suppliers': 'Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†',
                    'reports': 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±',
                    'settings': 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª'
                };
                document.getElementById('page-title').innerText = titles[viewId];
                
                // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø±
                const activeBtn = Array.from(document.querySelectorAll('.nav-btn')).find(b => b.getAttribute('onclick').includes(viewId));
                if(activeBtn) activeBtn.classList.add('active');

                // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ù„ÙƒÙ„ Ù‚Ø³Ù…
                if (viewId === 'dashboard') dashboard.render();
                if (viewId === 'inventory') inventory.render();
                if (viewId === 'sales') sales.render();
                if (viewId === 'expenses') expenses.render();
                if (viewId === 'suppliers') suppliers.render();
            },

            updateDate: function() {
                const now = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('date-display').innerText = now.toLocaleDateString('ar-SD', options);
            },

            formatMoney: function(amount) {
                return new Intl.NumberFormat('ar-SD').format(amount) + ' Ø¬.Ø³';
            }
        };

        // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ---
        const inventory = {
            render: function() {
                const tbody = document.querySelector('#inventory-table tbody');
                tbody.innerHTML = '';
                const search = document.getElementById('inventory-search').value.toLowerCase();
                
                this.data = app.data.products.filter(p => p.name.toLowerCase().includes(search));

                this.data.forEach(p => {
                    const tr = document.createElement('tr');
                    const statusClass = p.qty < 10 ? 'status-low' : 'status-ok';
                    const statusText = p.qty < 10 ? 'Ù…Ù†Ø®ÙØ¶' : 'Ù…ØªÙˆÙØ±';
                    
                    tr.innerHTML = `
                        <td>${p.name}</td>
                        <td>${p.size}</td>
                        <td><span class="status-badge ${statusClass}">${p.qty} (${statusText})</span></td>
                        <td>${app.formatMoney(p.buyPrice)}</td>
                        <td>${app.formatMoney(p.sellPrice)}</td>
                        <td>${p.supplierName || '-'}</td>
                        <td>
                            <button class="btn btn-outline" style="padding: 5px 10px;" onclick="inventory.edit(${p.id})">âœï¸</button>
                            <button class="btn btn-danger" style="padding: 5px 10px;" onclick="inventory.delete(${p.id})">ğŸ—‘ï¸</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            },

            openModal: function(id = null) {
                const modal = document.getElementById('product-modal');
                const title = document.getElementById('modal-title');
                const supSelect = document.getElementById('prod-supplier');
                
                // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
                supSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ±Ø¯</option>';
                app.data.suppliers.forEach(s => {
                    supSelect.innerHTML += `<option value="${s.name}">${s.name}</option>`;
                });

                if (id) {
                    const p = app.data.products.find(x => x.id === id);
                    document.getElementById('prod-id').value = p.id;
                    document.getElementById('prod-name').value = p.name;
                    document.getElementById('prod-size').value = p.size;
                    document.getElementById('prod-qty').value = p.qty;
                    document.getElementById('prod-buy').value = p.buyPrice;
                    document.getElementById('prod-sell').value = p.sellPrice;
                    document.getElementById('prod-supplier').value = p.supplierName;
                    title.innerText = 'ØªØ¹Ø¯ÙŠÙ„ ØµÙ†Ù';
                } else {
                    document.getElementById('prod-id').value = '';
                    document.getElementById('prod-name').value = '';
                    document.getElementById('prod-size').value = '';
                    document.getElementById('prod-qty').value = '';
                    document.getElementById('prod-buy').value = '';
                    document.getElementById('prod-sell').value = '';
                    document.getElementById('prod-supplier').value = '';
                    title.innerText = 'Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯';
                }
                modal.classList.add('active');
            },

            save: function() {
                const id = document.getElementById('prod-id').value;
                const newProd = {
                    id: id ? parseInt(id) : Date.now(),
                    name: document.getElementById('prod-name').value,
                    size: document.getElementById('prod-size').value,
                    qty: parseInt(document.getElementById('prod-qty').value),
                    buyPrice: parseFloat(document.getElementById('prod-buy').value),
                    sellPrice: parseFloat(document.getElementById('prod-sell').value),
                    supplierName: document.getElementById('prod-supplier').value
                };

                if (id) {
                    const index = app.data.products.findIndex(p => p.id == id);
                    app.data.products[index] = newProd;
                } else {
                    app.data.products.push(newProd);
                }

                app.saveData();
                document.getElementById('product-modal').classList.remove('active');
                this.render();
            },

            edit: function(id) { this.openModal(id); },
            
            delete: function(id) {
                if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙ†ÙØŸ')) {
                    app.data.products = app.data.products.filter(p => p.id !== id);
                    app.saveData();
                    this.render();
                }
            }
        };

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ---
        const sales = {
            cart: [],

            render: function() {
                this.cart = [];
                this.updateCartUI();
                this.filterProducts();
            },

            filterProducts: function() {
                const search = document.getElementById('sales-search').value.toLowerCase();
                const grid = document.getElementById('sales-products-grid');
                grid.innerHTML = '';

                const filtered = app.data.products.filter(p => p.name.toLowerCase().includes(search) && p.qty > 0);

                filtered.forEach(p => {
                    const div = document.createElement('div');
                    div.className = 'product-card';
                    div.innerHTML = `
                        <div class="name">${p.name}</div>
                        <div class="price">${app.formatMoney(p.sellPrice)}</div>
                        <div class="stock">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${p.qty}</div>
                    `;
                    div.onclick = () => this.addToCart(p);
                    grid.appendChild(div);
                });
            },

            addToCart: function(product) {
                const existing = this.cart.find(item => item.id === product.id);
                if (existing) {
                    if (existing.qty < product.qty) {
                        existing.qty++;
                    } else {
                        alert('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ…ÙŠØ© ÙƒØ§ÙÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†');
                        return;
                    }
                } else {
                    this.cart.push({ ...product, qty: 1 });
                }
                this.updateCartUI();
            },

            updateCartUI: function() {
                const container = document.getElementById('cart-items-container');
                container.innerHTML = '';
                let total = 0;

                this.cart.forEach((item, index) => {
                    const itemTotal = item.sellPrice * item.qty;
                    total += itemTotal;
                    const div = document.createElement('div');
                    div.className = 'cart-item';
                    div.innerHTML = `
                        <div>
                            <div>${item.name}</div>
                            <small>${item.qty} x ${item.sellPrice}</small>
                        </div>
                        <div style="display:flex; align-items:center; gap:5px;">
                            <span>${itemTotal}</span>
                            <button class="btn btn-danger" style="padding: 2px 6px; font-size: 0.8rem;" onclick="sales.removeFromCart(${index})">x</button>
                        </div>
                    `;
                    container.appendChild(div);
                });

                document.getElementById('cart-total-display').innerText = total;
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ø§Ù‚ÙŠ
                const paid = parseFloat(document.getElementById('cart-payment').value) || 0;
                const change = paid - total;
                const changeEl = document.getElementById('cart-change');
                if (paid > 0) {
                    changeEl.innerText = change >= 0 ? `Ø§Ù„Ø¨Ø§Ù‚ÙŠ: ${change} Ø¬.Ø³` : `Ù†Ø§Ù‚Øµ: ${Math.abs(change)} Ø¬.Ø³`;
                    changeEl.style.color = change >= 0 ? 'var(--secondary-color)' : 'red';
                } else {
                    changeEl.innerText = '';
                }
            },

            removeFromCart: function(index) {
                this.cart.splice(index, 1);
                this.updateCartUI();
            },

            clearCart: function() {
                this.cart = [];
                document.getElementById('cart-payment').value = '';
                this.updateCartUI();
            },

            checkout: function() {
                if (this.cart.length === 0) return alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©');
                
                const total = this.cart.reduce((sum, item) => sum + (item.sellPrice * item.qty), 0);
                const paid = parseFloat(document.getElementById('cart-payment').value) || 0;

                if (paid < total) {
                    if(!confirm(`Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ (${paid}) Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (${total}). Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ`)) return;
                }

                // Ø®ØµÙ… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                const invoiceId = 'INV-' + Date.now();
                let totalCost = 0;
                let totalProfit = 0;

                this.cart.forEach(item => {
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                    const product = app.data.products.find(p => p.id === item.id);
                    if (product) {
                        product.qty -= item.qty;
                        totalCost += (product.buyPrice * item.qty);
                    }
                    totalProfit += ((item.sellPrice - (product ? product.buyPrice : 0)) * item.qty);
                });

                const saleRecord = {
                    id: invoiceId,
                    date: new Date().toISOString(),
                    items: [...this.cart],
                    total: total,
                    paid: paid,
                    cost: totalCost,
                    profit: totalProfit
                };

                app.data.sales.push(saleRecord);
                app.saveData();

                // Ø·Ø¨Ø§Ø¹Ø©
                this.printInvoice(saleRecord);
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                this.clearCart();
                this.render(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ§Øª
            },

            printInvoice: function(sale) {
                document.getElementById('print-inv-id').innerText = sale.id;
                document.getElementById('print-date').innerText = new Date(sale.date).toLocaleString('ar-SD');
                
                const tbody = document.getElementById('print-items');
                tbody.innerHTML = '';
                sale.items.forEach(item => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${item.name}</td>
                            <td>${item.qty}</td>
                            <td>${item.sellPrice}</td>
                            <td>${item.sellPrice * item.qty}</td>
                        </tr>
                    `;
                });

                document.getElementById('print-total').innerText = app.formatMoney(sale.total);
                document.getElementById('print-paid').innerText = app.formatMoney(sale.paid);
                document.getElementById('print-change').innerText = app.formatMoney(sale.paid - sale.total);

                const printContent = document.getElementById('print-area').innerHTML;
                const originalContent = document.body.innerHTML;

                // Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø³ÙŠØ·Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©: Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø´ÙŠØ¡ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙÙ‚Ø· Ø¹Ø¨Ø± CSS
                window.print();
            }
        };

        // --- Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª ---
        const expenses = {
            render: function() {
                const tbody = document.querySelector('#expenses-table tbody');
                tbody.innerHTML = '';
                // ØªØ±ØªÙŠØ¨ ØªÙ†Ø§Ø²Ù„ÙŠ Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®
                const sorted = [...app.data.expenses].sort((a,b) => new Date(b.date) - new Date(a.date));
                
                sorted.forEach((exp, index) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${exp.date}</td>
                        <td>${exp.name}</td>
                        <td style="color: red; font-weight: bold;">${app.formatMoney(exp.amount)}</td>
                        <td><button class="btn btn-danger" style="padding: 2px 5px;" onclick="expenses.delete(${exp.id})">x</button></td>
                    `;
                    tbody.appendChild(tr);
                });
            },

            add: function() {
                const name = document.getElementById('exp-name').value;
                const amount = parseFloat(document.getElementById('exp-amount').value);
                const date = document.getElementById('exp-date').value || new Date().toISOString().split('T')[0];

                if (!name || !amount) return alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');

                app.data.expenses.push({
                    id: Date.now(),
                    name, amount, date
                });
                app.saveData();
                
                document.getElementById('exp-name').value = '';
                document.getElementById('exp-amount').value = '';
                this.render();
            },

            delete: function(id) {
                if(confirm('Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙØŸ')) {
                    app.data.expenses = app.data.expenses.filter(e => e.id !== id);
                    app.saveData();
                    this.render();
                }
            }
        };

        // --- Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† ---
        const suppliers = {
            render: function() {
                const tbody = document.querySelector('#suppliers-table tbody');
                tbody.innerHTML = '';
                
                app.data.suppliers.forEach(s => {
                    // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ±Ø¯
                    const totalPurchases = app.data.products
                        .filter(p => p.supplierName === s.name)
                        .reduce((sum, p) => sum + (p.buyPrice * (p.qty || 0)), 0); // ØªÙ‚Ø¯ÙŠØ± ØªÙ‚Ø±ÙŠØ¨ÙŠ Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ

                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${s.name}</td>
                        <td>${s.phone}</td>
                        <td>${app.formatMoney(totalPurchases)}</td>
                        <td><button class="btn btn-danger" style="padding: 2px 5px;" onclick="suppliers.delete(${s.id})">x</button></td>
                    `;
                    tbody.appendChild(tr);
                });
            },

            add: function() {
                const name = document.getElementById('sup-name').value;
                const phone = document.getElementById('sup-phone').value;
                
                if(!name) return alert('Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨');

                app.data.suppliers.push({ id: Date.now(), name, phone });
                app.saveData();
                
                document.getElementById('sup-name').value = '';
                document.getElementById('sup-phone').value = '';
                this.render();
            },

            delete: function(id) {
                if(confirm('Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ±Ø¯ØŸ')) {
                    app.data.suppliers = app.data.suppliers.filter(s => s.id !== id);
                    app.saveData();
                    this.render();
                }
            }
        };

        // --- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ---
        const dashboard = {
            render: function() {
                const today = new Date().toISOString().split('T')[0];
                
                // ÙÙ„ØªØ±Ø© Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…
                const todaySales = app.data.sales.filter(s => s.date.startsWith(today));
                const totalSales = todaySales.reduce((sum, s) => sum + s.total, 0);
                const totalProfit = todaySales.reduce((sum, s) => sum + s.profit, 0);

                // Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„ÙŠÙˆÙ…
                const todayExpenses = app.data.expenses.filter(e => e.date === today);
                const totalExpenses = todayExpenses.reduce((sum, e) => sum + e.amount, 0);

                // ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                const lowStock = app.data.products.filter(p => p.qty < 10).length;

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                document.getElementById('dash-today-sales').innerText = app.formatMoney(totalSales);
                document.getElementById('dash-today-profit').innerText = app.formatMoney(totalProfit);
                document.getElementById('dash-today-expenses').innerText = app.formatMoney(totalExpenses);
                document.getElementById('dash-low-stock').innerText = lowStock;

                // Ø¢Ø®Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (Ø¯Ù…Ø¬ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ù…ØµØ±ÙˆÙØ§Øª)
                const recent = [
                    ...todaySales.map(s => ({ type: 'Ø¨ÙŠØ¹', detail: s.id, amount: s.total, time: s.date })),
                    ...todayExpenses.map(e => ({ type: 'Ù…ØµØ±ÙˆÙ', detail: e.name, amount: -e.amount, time: e.date + ' 00:00' }))
                ].sort((a,b) => new Date(b.time) - new Date(a.time)).slice(0, 5);

                const tbody = document.querySelector('#dash-recent-table tbody');
                tbody.innerHTML = '';
                recent.forEach(r => {
                    const color = r.amount > 0 ? 'green' : 'red';
                    tbody.innerHTML += `
                        <tr>
                            <td>${r.type}</td>
                            <td>${r.detail}</td>
                            <td style="color: ${color}; font-weight: bold;">${app.formatMoney(Math.abs(r.amount))}</td>
                            <td>${new Date(r.time).toLocaleTimeString('ar-SD', {hour: '2-digit', minute:'2-digit'})}</td>
                        </tr>
                    `;
                });
            }
        };

        const reports = {
            generate: function() {
                const start = document.getElementById('report-start').value;
                const end = document.getElementById('report-end').value;

                if (!start || !end) return alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ®');

                const filteredSales = app.data.sales.filter(s => {
                    const d = s.date.split('T')[0];
                    return d >= start && d <= end;
                });

                const totalSales = filteredSales.reduce((sum, s) => sum + s.total, 0);
                const totalProfit = filteredSales.reduce((sum, s) => sum + s.profit, 0);
                const totalCost = filteredSales.reduce((sum, s) => sum + s.cost, 0);

                // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                const statsDiv = document.getElementById('report-stats');
                statsDiv.innerHTML = `
                    <div class="stat-card"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3><div class="value">${app.formatMoney(totalSales)}</div></div>
                    <div class="stat-card"><h3>ØªÙƒÙ„ÙØ© Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø©</h3><div class="value">${app.formatMoney(totalCost)}</div></div>
                    <div class="stat-card"><h3>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</h3><div class="value" style="color: var(--secondary-color)">${app.formatMoney(totalProfit)}</div></div>
                `;

                // Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                const tbody = document.querySelector('#report-table tbody');
                tbody.innerHTML = '';
                filteredSales.forEach(s => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${s.id}</td>
                            <td>${s.date.split('T')[0]}</td>
                            <td>${app.formatMoney(s.total)}</td>
                            <td>${app.formatMoney(s.profit)}</td>
                        </tr>
                    `;
                });
            }
        };

        // --- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ---
        const settings = {
            backup: function() {
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(app.data));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "backup_bag_shop_" + new Date().toISOString().split('T')[0] + ".json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            },

            restore: function(input) {
                const file = input.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const json = JSON.parse(e.target.result);
                        if (json.products && json.sales && json.expenses && json.suppliers) {
                            app.data = json;
                            app.saveData();
                            alert('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                            location.reload();
                        } else {
                            alert('Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­');
                        }
                    } catch(err) {
                        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù');
                    }
                };
                reader.readAsText(file);
            },

            reset: function() {
                if(confirm('âš ï¸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) {
                    localStorage.removeItem('sudan_bag_shop_v1');
                    sessionStorage.removeItem('isLoggedIn');
                    alert('ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…');
                    location.reload();
                }
            }
        };

        // --- ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ---
        document.addEventListener('DOMContentLoaded', function() {
            app.init();

            // ØªØ­Ø¯ÙŠØ« Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹
            const paymentInput = document.getElementById('cart-payment');
            if(paymentInput){
                paymentInput.addEventListener('input', function(){
                    sales.updateCartUI();
                });
            }
        });
    </script>

</body>
</html>